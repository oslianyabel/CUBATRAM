{% extends 'base.html' %}
{% load static %}

{% block content %}
    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content" style="
        background: linear-gradient(182.52deg, rgba(255, 255, 255, 0) 37.74%, rgba(255, 255, 255, 0.5) 97.89%), url('{% if hero_section.background_image %}{{ hero_section.background_image.url }}{% else %}{% static 'img/banner.jpg' %}{% endif %}');
        background-repeat: no-repeat;
        background-size: cover;
        ">  
            <form id="tourSearchForm" class="hero-buttons">
                <!-- Destinations -->
                {% if destinations %}
                <div class="dropdown">
                    <button type="button" class="btn btn-secondary dropdown-toggle" id="dropdownMenu1">
                        Select Destination
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenu1">
                        {% for destination in destinations %}
                            <label class="dropdown-item">
                                <input type="checkbox" name="destination" value="{{ destination.slug|default:destination.id }}" 
                                       {% if forloop.first %}checked{% endif %}>
                                {{ destination.name }}
                            </label>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Categories -->
                {% if categories %}
                <div class="dropdown">
                    <button type="button" class="btn btn-secondary dropdown-toggle" id="dropdownMenu2">
                        Select Category
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                        {% for category in categories %}
                            <label class="dropdown-item">
                                <input type="checkbox" name="category" value="{{ category.slug|default:category.id }}"
                                       {% if forloop.first %}checked{% endif %}>
                                {{ category.title }}
                            </label>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <button type="submit" class="btn btn-primary">Find Tour</button>
            </form>
        </div>
        
        <!-- Featured Categories Section -->
        <div class="cards-container" style="margin-top: 60px;">
            {% for category in featured_categories|slice:":3" %}
            <div class="card" style="
            background: linear-gradient(180deg, rgba(239, 141, 101, 0) 42.31%, #EF8D65 84.62%), url('{% if category.image %}{{ category.image.url }}{% else %}{% static 'img/card.png' %}{% endif %}'); 
            background-repeat: no-repeat;
            background-size: cover;
            ">
                <div class="card-text">
                    <a href="{% url 'tour_list' %}?category={{ category.slug }}">{{ category.title }}</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Popular Destinations -->
    <section class="cards-section">
        <h2 class="section-title">{{hero_section.title1}}</h2>
        <div class="cards-container">
            {% for destination in popular_destinations|slice:":3" %}
            <div class="card" style="
            background: linear-gradient(180deg, rgba(239, 141, 101, 0) 42.31%, #EF8D65 84.62%), url('{% if destination.image %}{{ destination.image.url }}{% else %}{% static 'img/card.png' %}{% endif %}');
            background-repeat: no-repeat;
            background-size: cover;
            ">
                <div class="card-text">
                    <a href="">{{ destination.name }}</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Adventure Tours -->
    <section class="cards-section">
        <h2 class="section-title">{{hero_section.title2}}</h2>
        <div class="cards-container">
            {% for tour in adventure_tours|slice:":3" %}
            <div class="card" style="
            background: linear-gradient(180deg, rgba(239, 141, 101, 0) 42.31%, #EF8D65 84.62%), url('{% if tour.main_image %}{{ tour.main_image.url }}{% else %}{% static 'img/card.png' %}{% endif %}');
            background-repeat: no-repeat;
            background-size: cover;
            ">
                <div class="card-text">
                    <a href="#">{{ tour.title }}</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Info Section -->
    <section class="info-section">
        <div class="info-header">
            <h2 class="info-title">{{ info_section.title }}</h2>
            <p class="info-subtitle">{{ info_section.subtitle }}</p>
        </div>
        
        <p class="info-content">
            {{ info_section.content }}
        </p>
        
        <div class="info-points">
            {% for point in info_section.points.all %}
            <div class="info-point">
                <div class="point-marker">
                    <img src="{% static 'svg/'|add:point.icon %}" alt="">
                </div>
                <p class="info-content">
                    {{ point.content }}
                </p>
            </div>
            {% endfor %}
        </div>

        <a id="button-booking" class="button-booking rezdy rezdy-modal" href="https://therahmatygroup.rezdy.com" style="background: rgb(0, 82, 241); border: 1px solid rgb(0, 82, 241); color: rgb(255, 255, 255); font: bold 14px / 1 &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; padding: 12px 15px; text-align: center; width: 160px; display: block; text-decoration: none; cursor: pointer;">Book Now</a>
    </section>

    <!-- Featured Tours Section -->
    <section class="products-section">
        <div class="container">
            <div class="product-list">
                {% for tour in featured_tours %}
                <!-- Product Item -->
                <div class="product-item">
                    <div class="product-image" style="
                    background: linear-gradient(180deg, rgba(239, 141, 101, 0) 42.31%, #EF8D65 84.62%), url('{% if tour.main_image %}{{ tour.main_image.url }}{% else %}{% static 'img/card.png' %}{% endif %}');
                    background-repeat: no-repeat;
                    background-size: cover;
                    "></div>
                    <div class="product-info">
                        <h2 class="product-title">{{ tour.title }}</h2>
                        <p class="product-description">
                            {{ tour.short_description }}
                        </p>
                        <p class="product-price">Adult Price: ${{ tour.adult_price }} USD</p>
                        <a href="#" class="btn btn-primary">View Details</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Special Offers -->
    <section class="footer-cards">
        <h2 class="section-title">{{hero_section.title3}}</h2>
        <div class="cards-container">
            {% for offer in special_offers %}
            <div class="card" style="
            background: linear-gradient(180deg, rgba(239, 141, 101, 0) 42.31%, #EF8D65 84.62%), url('{% if offer.image %}{{ offer.image.url }}{% else %}{% static 'img/card.png' %}{% endif %}');
            background-repeat: no-repeat;
            background-size: cover;
            ">
                <div class="card-text">
                    {{ offer.title }}
                    {% if offer.discount_percentage %}
                    <span class="discount-badge">{{ offer.discount_percentage }}% OFF</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
{% endblock %}

{% block extra_js %}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Manejar el formulario de búsqueda
        const tourSearchForm = document.getElementById('tourSearchForm');
        
        if (tourSearchForm) {
            tourSearchForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Obtener destinos seleccionados
                const destinationCheckboxes = tourSearchForm.querySelectorAll('input[name="destination"]:checked');
                const destinations = Array.from(destinationCheckboxes).map(cb => cb.value).join(',');
                
                // Obtener categorías seleccionadas
                const categoryCheckboxes = tourSearchForm.querySelectorAll('input[name="category"]:checked');
                const categories = Array.from(categoryCheckboxes).map(cb => cb.value).join(',');
                
                // Construir URL
                let url = "{% url 'tour_list' %}?";
                if (destinations) url += `destinations=${destinations}&`;
                if (categories) url += `categories=${categories}`;
                
                // Redirigir
                window.location.href = url;
            });
            
            // Actualizar el texto del botón dropdown cuando se selecciona un item
            tourSearchForm.querySelectorAll('.dropdown').forEach(dropdown => {
                const toggle = dropdown.querySelector('.dropdown-toggle');
                const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]');
                
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const checkedItems = dropdown.querySelectorAll('input[type="checkbox"]:checked');
                        if (checkedItems.length === 0) {
                            toggle.textContent = toggle.id === 'dropdownMenu1' ? 'Select Destination' : 'Select Category';
                        } else if (checkedItems.length === 1) {
                            toggle.textContent = checkedItems[0].parentElement.textContent.trim();
                        } else {
                            toggle.textContent = `${checkedItems.length} selected`;
                        }
                    });
                });
            });
        }
    });
    </script>
    
    <script type="text/javascript" src="https://therahmatygroup.rezdy.com/pluginJs?script=modal"></script>
{% endblock %}